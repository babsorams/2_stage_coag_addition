# 2 Stage Coagulant Addition, Spring 2018
#### Barbara Oramah, Ching Pang，Yuhao Du
#### March 1, 2018

<div class="alert alert-block alert-danger">
Casey - please grade this report according to the criteria in the report rubric. Use these comments as the main mode of feedback.
</div>

## Abstract
**Previous work:** Last semester, our group designed and fabricated the experiment apparatus and conducted experiment for both 1 stage and 2 stages coagulant addition. Our data is not enough to come up with a grand conclusion, but it suggested that there might be trade-off when we switch from 1 stage to 2 stages. Besides, we also made some simplification to our system.~~

**Goals & Objectives:** This semester, our group focused on comparing 1 stage addition with 2 stage addition and carrying on the experiment with different influent turbidities, coagulant dosage, and humic acid concentration as well as trying to improve Yingda's coagulant dosage model. Besides, more insight on the particles bond mechanism, flocculation, and geometry of the contact chambers were needed. Eventually, we will try to close the debate of 1 stage vs 2 stage, come up with a conclusion and generate enough data to support it.~~

**What we have accomplished:** Up to now we have completed the literature review, and working on apparatus set up. The research was based on Yingda's thesis, who studied the effect of humic acid on the coagulant dosing model. Based on the bonding mechanism, it could be hypothesized that two-stage coagulant addition would increase the removal efficiency of particles while maintaining the coagulant dosage.

**Future work:** We have encountered several problems: the high pressure within the system, the leak caused by the poor connection. In next few weeks, we would fix those problems and begin to conduct our experiment. After discussed with Monroe, we suspected that the size of our first contact chamber is not enough for the HA and coag nanoparticles in the synthetic water to generate enough successful collision, so recalculation and test on the CC are also required.~~


## Introduction

The physical and chemical process in flocculation is critical to the optimization of water treatment process, thus a predictive model that can describe the flocculation process is needed. However, in the past research of AguaClara project team, the model we built only consider the clay and coagulant in the system, it is does not replicate the real-life engineering application because NOM can be found in nearly every surface water resources and some of the groundwater resources and the presence of NOM can create a need for increased coagulant doses in drinking water treatment.

So we have to extend the model base on our past research by taking the effect of NOM on flocculation into consideration. After studying the bond mechanism between clay, humic acid, and coagulant, we came up with an assumption that we could add the coagulant separately to save the amount of coagulant, because it was assumed that after stage 1, all coagulant would be coated by humic acid, thus the coagulant adds in stage 2 could merely function as an agglomerant then achieved better performance in flocculation process and the aggregation process. After we have the model, we can try to optimize our water treatment process, for example, using the coagulant more efficiently and cutting down the operational cost. As AguaClara is an engineering project team with limited resources, cost should always be taken into consideration.

## Literature Review and Previous Work

The fundamental objective of the two stage coagulant addition subteam is to research and find out if there are beneficial effects of two stage addition of PaCl. This would theoretically allow us to use our coagulant more efficiently which would consequently also reduce cost. Besides lab research, this requires research from external parties and other AguaClara teams. We investigated the effects of humic Acid in water and how it coagulates, as well as revisiting Yingda Du’s thesis on the effects of humic acid on flocculation. With this background knowledge, this would aid our advancement in our research.

Humic acid is considered natural organic matter, and it is of the final components made after the breakdown of plant and animal decay. It is commonly found in the soil as it promotes a fertility, it is also used as fertilizers. There is an increase in humic acid concentrations in the wet seasons. The most visual issue of humic acid is that it cause water to change color. However, in the process of creating potable water, the addition of other compounds and elements with humic acid assists the formation of harmful byproducts such as trihalomethane and haloacetic acid.

### Observations and a Geometric Explanation of the Effects of Humic Acid (HA) on Flocculation
  The general science behind flocculation can be understood by analyzing the thesis of the observations and a geometric explanation of the effects of HA flocculation by Yingda Du. The thesis gives a clear layout of why we are using HA as the natural organic matter as well as the chemistry behind the creation of flocs. We are using HA as the exemplary compound to represent dissolved NOM because it is the most commonly found form of NOM in our surroundings. Clay is used to represent the colloidal solids. As NOM is easily found in our soil and water, it increases our need of coagulant to promote flocculation of dissolved particles in water.  Hence why in our model of the experiment we add humic acid and clay with the coagulant PaCl (polyaluminium chloride). However, there is a cut-off point as to how much coagulant we can add to the raw water for it to be beneficial in the removal of NOM. This observation shows that some NOM becomes increasingly uncooperative to being removed due to the increased presence of coagulant. Our understanding of the lack of floc formation in the presence of increased coagulant addition is limited, yet it is an area of interest in determining the magnitude of the effect.

Nevertheless, Yingda’s report focuses on the effect on coagulation of humic acid in the form of hydraulic flocculation, with the consideration of the following processes of filtration and sedimentation. Her research is crucial to our subteam as it provides us with a basis of how we should set up our own apparatus, as well as the physics behind the creation of flocs.

### Using PACl as neutralizer and coagulant aid
Coagulation is one of the most effective methods to remove fine substances from particles. Polyaluminum Chloride (PAC) is often associated with this process to reduce DBPs precursors, which is potentially harmful. PACl prepolymerized coagulants are widely preferred because of its wide range of targets, such as low dosage, wide pH range, low sensitivity of temperature and low residual metal-ion concentration (Sudoh et. al., 2015). The effect of PACl with Calcium Carbonate in removing Humic Acid was significantly efficient comparing to other chemicals, because such combination acts as both alkaline chemical and coagulant agent. Comparing with other coagulant types such as Ferric Acid and Aluminum Sulfate, PACl has a significantly high removal efficiency even at a low dosage. In addition, the removal rate of PACl is higher than that of NaOH as alkaline agent.

### Effectiveness of Two-Stage Coagulant Addition
Based on Yingda's Thesis, the presence of humic acid as NOM affects the use of PACl as a coagulant for synthetic surface water, but in a one-stage setting, meaning the coagulant is added at once. Last semester, our model considered the attachment efficiency for the hydraulic flocculation. However, past studies have investigated the difference of efficiency of two-stage coagulant addition, meaning adding the coagulants at two different points, comparing with one-stage. (Liu et. al., 2011) Keeping the total amount of coagulant at the same dosage, when partial amount was added half-way, it was found that two-stage can produce floc 1.5 times the floc size comparing with one-stage, which potentially made two-stage more efficient to one-stage. As the floc blanket was formed, the flocs were connected together to for larger adn more irregular structure, making two-stage addition more time-efficient than one-stage.

## Methods

### Experimental Design

In our experiment, there should be two contact chambers before the fluid entered the flocculator, they are places for coagulant to collide with particles in the water. Originally, We designed the pump to input the correct coagulant dosage before each contact chamber, allowing the two stage coagulant addition. However, the ProCoDA system we used had its limit, the maximum number of pump it could control was 2, so there had to be one coagulant pump under manual control. So we changed the design, we used the second pump to drain from the first pump when we ran the two stages addition experiment.

Finally, we decided to carry out the following procedure. The humic acid would be a fixed variable and the turbidity and the coagulant dosage would vary. Firstly, a set of one stage coagulant addition experiments was carried out while we kept the second coagulant pump closed. The goal of this set of experiment was finding the coagulant dosage which could reduce the effluent turbidity to 3 NTU or less, which was the value that AguaClara filter system requires. After that, the dosage used in that first experiment (1 stage addition) was divided into two parts, where we would find the perfect distribution, at that point most of the coagulant from the first coagulant pump would be used to absorb the humic acid in the system, and coagulant adds by the second pump would only work on lowering the turbidity to be able to attach to every particle in the system to its surface. In order to do this, we installed a T-connection between the two coagulant pumps. This helped us manage the amount of coagulant that was put into the system. The idea behind this was that the first pump would control the total amount of coagulant being put into the system. When the second coagulant pump was open, it would be able to control how much coagulant would be used for the second dosage, drain directly from the first valve, so we could maintain a fixed dosage of the total amount of coagulant put in. This helped us test whether or not having a second dosage of coagulant before the second contact chamber would make the experiment perform better than the total amount of coagulant dosage in one stage.

### Experimental Apparatus

* Design (calculations, constraints)
The ProCoDA system can only control two pumps, and one of the coagulant pump had to be connected to the system, so we could not add humic acid and clay separately like some of other groups in the lab.

* Schematic (label parts)
![apparatus](image/ApparatusSketch.jpg)
   Figure： Apparatus Diagram

The way in which the apparatus worked was the following. To start with, clay, humic acid and water were added according to the calculation, into a 10L stock tank with a stir. This stock tank was connected to the clay pump, the pump speed would be control by ProCoDA system to maintain a relatively fixed influent turbidity. After that, mixture of humic acid and clay went through the first turbidity meter and influent turbidity of the raw water is measured.

Following this, the first dosage of coagulant was added right before the mixture entered the first contact chamber so when it entered the first contact chamber, all of the particles were stuck one with each other.

The second stream of coagulant was pumped into the system after the first contact chamber if we were running a two staged addition experiment.
Initially, we designed a method depending on whether the experiment require the addition of the second coagulant dosage or not, a valve was put so that we could control the coagulant addition. However, it was discovered that better idea to do it in a different way: the valve was taken out and the first coagulant addition pump was connected to the second coagulant addition pump. In this way, if a one addition test was being carried out, the first pump would work providing the previously set coagulant amount. On the other hand, if a two stage test was being carried out, while the first pump was providing the same dosage as before, the second pump would subtract from that the amount required for the second dosage addition.

Then, the mixture continued on to the second chamber. This can be seen in the following image.

* Image

![apparatus](image/CurrentApparatus2.png)

Figure: Current Apparatus Set-up

* Complications in construction
 It is kind of hard to make a perfect system without any leak, because many parts we used in apparatus fabrication is processed by ourself, for example the cut and the drilling, also the "tube stretch". So it required us to keep monitoring the behavior of our apparatus, and fix the problem whenever it occurs.

* Summary: After the study of last semester and this semester, we came up with this current design. Due to the limit bench area, there is a lot of simplification in our apparatus set-up, but it did reflect the nature of the AguaClara water treatment plant. The next step of our experiment apparatus improvement is to reduce simplification, and recalculation on the size of contact chamber is also required.

### Procedure
For one stage addition experiment, in every single circulation, the coag dosage is: 1.1-2.6mg/L, which was increased 7 times using the increment function, in which the values were derived based on those used by Yingda (Author of our reference thesis). We should add two more data point, one between 1-1.5, and the other between 1.5-2.0. Because in the past we generated desirable effluent turbidity around that range, besides, we don't have to start from 0.5mg/L, for that value is too low to treat the raw water.

We are planning to run 3 circulations per week, which will take 3 days, and we will use different humic acid between those 3 different trials within a week. Thus we can test the impact of both humic acid and coagulant dosage on the flocculating process.

We will carry on series of control experiment for 2 stages addition, and find the most effective portion of coagulant allocation. Then we will compare with data generated from 1 stage experiment.

Two-stage coagulant addition experiment should base on the data we generate with one stage addition experiment, the total amount coag addition can be the least dosage which can achieve the effluent requirement, and then we add two more circulations for comparison, vary the total amount, +-0.5 on the basis of the first trial. During those weeks we conduct two stages addition, we won’t test the effect of humic acid on flocculation because the mechanism of this part should be similar between one and two stage.

## Results and Analysis

```python
import numpy as np
import pandas as pd
from matplotlib import pyplot as plt

from aide_design import floc_model as floc

from aide_design.units import unit_registry as u

import sys, os
GitPath = os.path.join('~', 'Documents', 'GitHub')
myGitHubdir=os.path.expanduser(GitPath)
sys.path.append(myGitHubdir)


k = 0.24
coag = np.array([0.53, 1.06, 1.59, 2.11, 2.56]) * u.mg/u.L
conc_humic_acid = np.array([0, 3, 6, 9, 12, 15] * u.mg/u.L)
# dataset[0] is the 50NTU, dataset[1] is the 100NTU.
# Within both subgroups, [0] is the pC.0, ranging evenly up to [5] which is the
# pC.15
dataset = np.array([[  # Dataset[0]: the 50NTU datasets
                     [0.634, 0.729, 0.891, 1.062, 1.205],
                     [0.563, 0.717, 0.903, 1.038, 1.193],
                     [0.136, 0.513, 0.793, 1.027, 1.095],
                     [0.109, 0.264, 0.749, 1.002, 1.089],
                     [0.084, 0.128, 0.647, 0.962, 1.057],
                     [0.061, 0.094, 0.308, 0.717, 0.928]
                     ],
                    [  # Dataset[1]: the 100NTU datasets
                     [0.746, 0.953, 1.191, 1.295, 1.414],
                     [0.563, 0.835, 1.085, 1.255, 1.403],
                     [0.185, 0.692, 0.971, 1.254, 1.390],
                     [0.105, 0.280, 0.956, 1.238, 1.361],
                     [0.097, 0.207, 0.740, 1.209, 1.316],
                     [0.084, 0.157, 0.566, 1.084, 1.314]
                     ]
                    ])
indexnames = ['{0} mg/L'.format(i) for i in np.arange(0,16,3)]
Data50NTU = pd.DataFrame(dataset[0], index=indexnames).T

Data100NTU = pd.DataFrame(dataset[1], index=indexnames).T
print(Data50NTU)

coagGraph = np.arange(1 * 10**-4, 25.1 * 10**-4, 1 * 10**-4) * u.kg/u.m**3
enerDis = 4.833 * u.mW/u.kg
temperature = 25 * u.degC
resTime = 302 * u.s
tubeDiam = 3/8 * u.inch
# Begin graphing the 50NTU datasets
plt.figure('50NTU', (6,6))
plt.title('50 NTU Graph')
plt.ylabel('pC*')
plt.xlabel('coagulant dosage (mg/L)')



plt.plot(coag, Data50NTU['0 mg/L'], 'r.', coag, Data50NTU['3 mg/L'], 'b.',
         coag, Data50NTU['6 mg/L'], 'g.', coag, Data50NTU['9 mg/L'], 'm.',
         coag, Data50NTU['12 mg/L'], 'c.', coag, Data50NTU['15 mg/L'], 'y.')

 plt.show()
 ```


 ![datalog](https://github.com/AguaClara/2_stage_coag_addition/blob/master/image/100NTU.png)

                        Figure: model result which guide our experiment

 ![datalog](https://github.com/AguaClara/2_stage_coag_addition/blob/master/image/experiment%20data.png)

                        Figure: one of the typical experiment we ran

In this plot
After describing a particular result, within a paragraph, go on to connect your work to fundamental physics/chemistry/statics/fluid mechanics, or whatever field is appropriate. Analyze your results and compare with theoretical expectations; or, if you have not yet done the experiments, describe your expectations based on established knowledge. Include implications of your results. How will your results influence the design of AguaClara plants? If possible provide clear recommendations for design changes that should be adopted. Show your experimental data in a professional way using the following guidelines:

* **Did these results line up with expectations?**
In this semster, up to now, we only did several trials of one stage addition. Our expectation for the one stage addtion is that the floc blanket can be found in our sedimentation tank and the effluent go down to a level that is desirable for the AguaClara filtration system. The effluent turbidity in several trials happened to be around 20NTU, we assumed that it was due to the limit time of our data acquisition state, namely, we did not give the system enough time to form the floc blanket, so we extend the duration of that state, from 3600 seconds to 4800.

* **What went wrong?**
As we can see, the effluent turbidiy did not vary a lot even though the increment function worked, after examining the data we found that the coagulant pump actually worked around its lowest speed, and the past research showed that our pump did not work well at that speed. Therefore, for future experiments, we are going to set a higher intercept for the increment function, so the lowest rpm in our experiment now is 12.

## Conclusions

At this point, we fully understood the ProCoDA system and could use the increment function to carry on set of control experiments with fixed turbidity and different coagulant dosage. Also we had implemented an electronic balance which also connects to the ProCoDA system to track the mass change of coagulant over time. It could offer us data to confirm our ProCoDA code will guide the pump to add coagulant to the amount we calculate.

Generally, we deduced that by using the current design of system, when the turbidity is relatively low, we will need more coagulant to reach the target effluent turbidity.In this experiment, our target effluent turbidity should be no more than 3 NTU, which is already expected with the standard Aguaclara system.

The calculation of coagulant dosage and the component of clay-humic acid mixture could be done on python now, we transfered the original MathCAD base code and translated it into python.

In the rest semester, we would keep running both one stage and two stage experiment.

If we validate our 2 stage hypothesis, we could use this model to guide the dosage in water treatment plant and save the coagulant, cut down the operational cost.

## Future Work
We have encountered several problems: the high pressure within the system, the leak caused by the poor connection. In next few weeks, we would fix those problems and begin to conduct our experiment. After discussed with Monroe, we suspected that the size of our first contact chamber is not enough for the HA and coag nanoparticles in the synthetic water to generate enough successful collision, so recalculation and test on the CC are also required.

## Bibliography
Logan, B. E., Hermanowicz, S. W., & Parker,A. S. (1987). A Fundamental Model for Trickling Filter Process Design. Journal (Water Pollution Control Federation), 59(12), 1029–1042.

## Fabrication Details
Include any information related to the fabrication of equipment, experimental apparatuses, or technologies. Include the purpose of each step and the fabrication methods used. Reference appropriate safety precautions.


## Experimental Methods
### Set-up
***attention：*** the content about experiment set-up is distributed to the fabriaction and experiment part.

### Experiment
**Step 1.** Make sure the stocks are filled. One stock will have a diluted solution of coagulant and the other will have a solution of water, clay, and humic acid. The concentration depends on the experiment you want to run.


**Step 2.** Once the stocks are ready, the water and wastewater valves are open, the turbidimeters open, and the apparatus completely filled with water, the experiment is now ready to run.

**Step 3.** Be sure to turn on the wastewater pump, next to the effluent turbidimeter, to ensure that the flocs in the weir are transported to the wastewater line. We do not want the flocs to go through the effluent turbidimeter.


**Step 4.** Go to ProCoDa and turn the state from OFF to ON to begin the clay pump so the influent turbidimeter will reach 100 NTU. Once the turbidimeter is steadily at 100 NTU, go back to ProCoDa and turn the stage from ON to Data acquisition state, which will turn on the coagulant pump.
**Step 5.** The Data Acquisition state will go back and forth with the Flush state which is used for second stage addition. The data will be recorded on an excel file to be analyzed later.
**Step 6.** Once the experiment was ran and the data collected, turn off ProCoDa and save the data. Proceed to the cleaning procedure when experimentation is finished.

### Cleaning Procedure
 Once the experiment is done, we want to completely wash out the apparatus so it will be ready for the next experiment.
 **Step 1.** Turn off the clay and coagulant pump while let the tap water pump run at a relative high speed.

**Step 2.** Remove entire apparatus from wall (recirculator \& tube settler) and throughly wash it out, then reattach it back to the wall

**Step 3.** Wash out the Flocculator by unplugging the connection between the the outflow tube from the influent turbidimeter and the flocculator, and plug in tubing from the nearby sink to wash out the flocculator. Make sure there is a bucket at the end of the flocculator that will collect the water.

**Step 4.** Clean the influent and effluent turbidimeter. Make sure to turn on the Bypass channel first! First, open the bypass valve. Second, pinch the black outflow tube. Third, close the inflow valve.

**Step 5.** Remove and wash out the vials from both turbidimeters. Refill the vials with clean water, then put back into the turbidimeters.Use Kim wipes to clean the glass throughly.

**Step 6.** Turn off water to the flocculator and detach the tubing. Hook up the influent turbidimeter back into flocculator then re-open the influent turbidimeter BUT keep the effluent turbidity meter closed. Turn on the water pump to clean out the influent turbidimeter as well as the flocculator.

**Step 7.** Pour out the coagulant reservoir into a different bucket and rinse reservoir with deionized water to make sure all residue is washed out. Take out the push pin then wash out the coagulant reservoir throughly. Replenish reservoir with 5L (or less) of deionized water. Use MathCAD to determine how much 70.9mg/L PAC coagulant needed to use to get the desired results for the experiment.

## Experimental Checklist
Before running the experiment, we check apparatus following steps below:

First, we open the influent and effluent turbidity meter and check whether the inside glass container is clean;

Second, before reassemble the turbidity meter again, we turn on only the water pump and let tap water run through the system to see if their is any leak in the system, especially near the turbidity meter, in case water would flow to interior of the meter and cause damage to the apparatus;

Third,  turn on all pumps and set them with a tiny RPM value, then check if pumps run in the right direction;

Fourth, go to the "edit rules" part of the ProCoDA, check the parameter of increment function, make sure those valve are set according to the calculation;

Fifth, and the last step, go the the "operation" part of ProCoDA, start the system with "Data Acquisition States" and make sure states would switch between one another automatically.

## ProCoDA Method File
Use this section to explain your method file. This could be broken up into several components as shown below:

### States

***I don't know why the template kept the format of Overleaf***

**{OFF}** - Resting state of ProCoDA. All sensors, relays, and pumps are turned off.

**{ON}** - ON state of ProCoDa. All sensors, relays, and pumps are turned on.

**{Data Acquisition}** - State 3 of the experimental process where the coagulant pump is working and the increment function would increase its value each time when we switch to this state. The data acquisition state usually set to be 2 hours, which is enough for the floc blanket to form.

**{Flush}** - State 4 of the experimental process where the coagulant pump stop working, during this stage raw water would run through the system and flush out the floc blanket build in last data acquisition state, so that every data acquisition state would run with same original system condition.


### Set Points

**{Turb target}** - This set point has the same value as our target influent turbidity, and would control the clay pump.

**{pump control(clay)}** - use this to decide which pump should we control.

**{Flush Time}** - Duration of the flush state.

**{Data Acquisition Time}** - Duration of the data acquisition state.

**{State to Increment}** - Tell the increment function when to increase its value, in this experiment, we use increment function to control coagulant pump speed.

**{Slope}** - The slope of increment function.

**{Intercept}** - The intercept of increment function.

**{Max x}** - How many time would the increment function work during one circulation.

**{coag pump control}** - use this to decide which coagulant pump should we control.

**{coag pump property}** - Flow rate per revolution.

**{balance}** - Variable with value returned by the electrical balance.



 ## Python Code

 ### Variables
 $g$: gravity
 $\sigma$: dispersion
 $a$: amplitude
 $h$: water depth
 $H$: distance from wave crest to trough (2$a$)
 $T$: wave period
 $\lambda$: wavelength
 $k$: wavenumber
 $c_p$: celerity (wave phase speed)
 $P$: pressure
 $F$: force
 $u$, $w$: x-velocity, z-velocity components

 ```python
 # flow rate of the system
 V_sedimentation = 2*(u.mm/u.s)
 # i did not have the ID data of the 1 inch PVC pipe
 ID_pipe = 0.96*u.inch
 Area_pipe = 0.25*np.pi*(ID_pipe**2)
 Q_system = V_sedimentation*Area_pipe
 # output the value

 # QUES: what is the relation of inlet water pump RPM w/ this value???

 print('The flow rate of the system is', (ut.sig(Q_system.to(u.mL/u.s),3)))
 # mass flow of coagulant

 # desired conc of PAC per L of water in the system. (0.5-2.5mg/L)(normally fixed range)

 conc_PACL = 1.1*(u.mg/u.L)
 # conc_PACL = np.array[(0.0,0.5,1.0,1.5)]
 MassFlow_coag = conc_PACL*Q_system
 print('The mass flow of coagulant in the system is',ut.sig(MassFlow_coag.to(u.mg/u.s),3))
 # how many mL of lab concentration are added per L into the reservoir(adjustable)
 k_dilution = 3.13*(u.ml/u.l)

 # concentration in grams per L of lab solution(normally fixed value)
 conc_labsolution = 70.9*(u.g/u.L)

 conc_reservoir = conc_labsolution*k_dilution
 Q_reservoir = MassFlow_coag/conc_reservoir
 print('The volumetric flow rate of solution leaving the reservior \
 and entering the system to achieve desired final concentration',Q_reservoir.to(u.mL/u.s))

 V_reservoir = 1*u.L
 V_lab_solution = V_reservoir*conc_reservoir/conc_labsolution
 print('The volume of lab concentration solution we need to add into the reservoir is',ut.sig(V_lab_solution,3))
 # The flow pumped out of the pump per round(measured by experiment)
 Q_perRPM_coag1 = 0.00042*(u.ml/u.s)
 # Q_perRPM_coag2 = 0.0025*(u.ml/u.s)
 numRPM = Q_reservoir/Q_perRPM_coag1
 print('The pump should run with a speed of',numRPM.to(u.dimensionless))
 ```


```python
# To convert the document from markdown to pdf
pandoc Name_of_this_file.md -o TeamName_Research_Report.pdf
```
